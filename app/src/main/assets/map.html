<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Leaflet OSM Map</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

    <link rel="stylesheet" href="leaflet.css"/>
    <style>
        body {
        padding: 0;
        margin: 0;
       }
        html, body, #map {
        height: 100%;
        width: 100vw;
        }
    </style>
</head>
<body>

<div id="map"></div>

<script src="leaflet.js"></script>
<script>
    function getUrlParameter(sParam) {
        var sPageURL = decodeURIComponent(window.location.search.substring(1)),
            sURLVariables = sPageURL.split('&'),
            sParameterName;

        for (var i = 0; i < sURLVariables.length; i++) {
            sParameterName = sURLVariables[i].split('=');
            if (sParameterName[0] === sParam) {
                return sParameterName[1] === undefined ? true : sParameterName[1];
            }
        }
    }


    var lat = parseFloat(getUrlParameter('lat')) || 0;
    var lon = parseFloat(getUrlParameter('lon')) || 0;
    var zoom = parseInt(getUrlParameter('zoom')) || 15;


    var map = L.map('map', {
        zoomControl: true
    }).setView([getUrlParameter('lat'), getUrlParameter('lon')], getUrlParameter('zoom'));


    // Uses Osm tile server
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    var marker;
    if (getUrlParameter('pin') === 'true') {
        marker = L.marker([lat, lon]).addTo(map);
    }

    // Notify Android of location and zoom changes
    map.on("moveend", function () {
        NativeInterface.transferLatLon(map.getCenter().lat, map.getCenter().lng);
    });

    map.on("zoomend", function () {
        NativeInterface.transferZoom(map.getZoom());
    });

    function updateLocation(lat, lon) {
        if (map && lat && lon) {
            map.setView([lat, lon], map.getZoom());
            if (typeof marker !== "undefined") {
                marker.setLatLng([lat, lon]);
            } else {
                marker = L.marker([lat, lon]).addTo(map);
            }
        }
    }
</script>

</body>
</html>